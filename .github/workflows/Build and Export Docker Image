# 工作流名称，随便起
name: Build and Export Docker Image

# 触发条件：当你往仓库推送代码时，自动执行这个工作流
on:
  push:
    branches: [ main ]  # 只在main分支推送代码时触发

# 要执行的任务
jobs:
  build-image:
    # 运行环境：用GitHub提供的Ubuntu系统（免费）
    runs-on: ubuntu-latest
    
    # 具体步骤
    steps:
      # 步骤1：把仓库的代码拉到云端电脑上
      - name: Checkout code
        uses: actions/checkout@v4
      
      # 步骤2：构建Docker镜像
      - name: Build Docker image
        run: docker build -t barkmonitor:v1 .  # 和本地构建命令一样
      
      # 步骤3：把镜像导出为tar包
      - name: Save image to tar file
        run: docker save -o barkmonitor.tar barkmonitor:v1
      
      # 步骤4：上传tar包，让你能下载
      - name: Upload tar package
        uses: actions/upload-artifact@v4
        with:
          name: barkmonitor-image  # 下载时显示的文件名
          path: barkmonitor.tar    # 要上传的文件路径
